# Understanding Agent Feedback

The Reflexio feedback system operates at the agent level, capturing and analyzing how users respond to agent interactions to drive continuous improvement of agent performance across all users.

## What Is Agent Feedback?

**Agent feedback represents user responses that indicate satisfaction, dissatisfaction, or suggestions for improvement regarding agent behavior.** Unlike user profiles (which are user-specific memory), feedback is **agent-level data** that helps improve agent performance for all users.

Think of the feedback system as your agent's performance review system - it automatically identifies when users provide feedback about agent behavior and aggregates these insights to guide agent improvement.

## Feedback vs. Profiles: Key Differences

| Aspect | User Profiles | Agent Feedback |
|--------|---------------|----------------|
| **Scope** | User-specific memory | Agent-wide performance |
| **Purpose** | Personalization | Improvement |
| **Data Level** | Individual user characteristics | Collective user satisfaction |
| **Usage** | Customize responses per user | Enhance agent for all users |
| **Lifetime** | Evolves with user | Tied to agent versions |

## The Feedback Extraction Process

### 1. Configurable Feedback Detection

Reflexio uses AI prompts that you configure to automatically identify feedback in user interactions:

```python
AgentFeedbackConfig(
    feedback_name="customer_service_feedback",
    feedback_definition_prompt="""
    Extract feedback about agent performance, including:
    - Complaints about agent responses or behavior
    - Suggestions for how the agent could improve
    - Praise for helpful or effective agent actions
    - Requests for different communication styles or approaches
    - Comments about agent understanding or misunderstanding
    - Reactions to agent recommendations or solutions

    Focus on actionable feedback that could improve future agent interactions.
    """,
    feedback_aggregator_config=FeedbackAggregatorConfig(
        min_feedback_threshold=3  # Need 3+ similar feedbacks before aggregating
    )
)
```

### 2. Intelligent Feedback Recognition

The AI doesn't just look for explicit complaints - it understands subtle feedback cues:

**User says:** *"I prefer more concise answers from you"*
**Extracted feedback:** *"Provide more concise answers and avoid lengthy explanations"*

**User says:** *"That's not quite what I was looking for..."*
**Extracted feedback:** *"Agent response didn't match user intent, improve query understanding"*

**User says:** *"Perfect! That's exactly what I needed."*
**Extracted feedback:** *"Response was accurate and helpful, maintain this approach"*

## Types of Agent Feedback

### Performance Feedback

Feedback about how well the agent performs its tasks:

```python
performance_feedback_examples = [
    "Agent provided accurate technical information",
    "Response was helpful but took too long to generate",
    "Agent missed the main point of the user's question",
    "Solution provided was exactly what was needed",
    "Agent should ask clarifying questions before responding"
]
```

### Communication Style Feedback

Feedback about how the agent communicates:

```python
communication_feedback_examples = [
    "Agent responses are too formal for casual conversations",
    "Appreciate the friendly and approachable tone",
    "Explanations are too technical for non-expert users",
    "Agent should be more empathetic in support situations",
    "Love the concise and direct communication style"
]
```

### Process and Workflow Feedback

Feedback about the agent's approach to problem-solving:

```python
workflow_feedback_examples = [
    "Agent should gather more context before providing solutions",
    "Step-by-step breakdown was very helpful",
    "Agent jumped to conclusions without understanding the problem",
    "Appreciate the follow-up questions to ensure understanding",
    "Should offer multiple options instead of just one solution"
]
```

### Feature and Capability Feedback

Feedback about what the agent can or should be able to do:

```python
capability_feedback_examples = [
    "Wish the agent could handle image analysis",
    "Agent needs better integration with external tools",
    "Great that the agent remembers previous conversations",
    "Should be able to schedule appointments automatically",
    "Agent could benefit from real-time data access"
]
```

## Feedback Lifecycle: From Raw to Actionable

### 1. Raw Feedback Generation

When users provide feedback about agent performance, Reflexio automatically:

```python
# Example interaction containing feedback
client.publish_interaction(
    user_id="frustrated_customer",
    interactions=[
        InteractionData(
            role="User",
            content="I already told you my budget is $500. Why do you keep recommending products over $1000?"
        )
    ],
    source="customer_support",
    agent_version="v2.1.3",
    request_group="support_session_042"
)

# Reflexio automatically extracts raw feedback:
# "Agent not respecting user's stated budget constraints"
```

### 2. Raw Feedback Storage

Each piece of raw feedback includes:

```python
class RawFeedback:
    raw_feedback_id: int           # Unique identifier
    agent_version: str             # Which agent version this applies to
    request_id: str                # Source interaction
    feedback_name: str             # Feedback category name
    created_at: int                # Timestamp
    feedback_content: str          # Extracted feedback text
    embedding: List[float]         # Vector embedding for similarity
```

### 3. Feedback Aggregation

Multiple raw feedbacks are aggregated when patterns emerge:

```python
# Multiple users provide similar feedback:
raw_feedbacks = [
    "Agent should respect budget constraints mentioned by users",
    "Agent ignores price limits provided by customers",
    "Agent recommendations exceed stated budget requirements",
    "Agent needs to better consider financial constraints"
]

# After threshold is met, Reflexio creates aggregated feedback:
aggregated_feedback = "Agent consistently fails to respect user budget constraints when making recommendations. Implement budget filtering in recommendation logic."
```

## Feedback Configuration Strategies

### Domain-Specific Feedback Systems

#### E-commerce Agent Feedback

```python
ecommerce_feedback = AgentFeedbackConfig(
    feedback_name="ecommerce_agent_feedback",
    feedback_definition_prompt="""
    Extract feedback about sales agent performance:
    - Product recommendation accuracy and relevance
    - Respect for budget constraints and price sensitivity
    - Understanding of customer needs and preferences
    - Communication style appropriateness for sales context
    - Helpfulness in product comparison and selection
    - Follow-up and customer service quality
    """,
    feedback_aggregator_config=FeedbackAggregatorConfig(min_feedback_threshold=5)
)
```

#### Educational Platform Feedback

```python
education_feedback = AgentFeedbackConfig(
    feedback_name="tutoring_agent_feedback",
    feedback_definition_prompt="""
    Extract feedback about tutoring agent effectiveness:
    - Clarity and quality of explanations
    - Appropriate difficulty level for student
    - Patience and encouragement in teaching style
    - Ability to adapt to different learning styles
    - Effectiveness of examples and practice problems
    - Progress tracking and feedback quality
    """,
    feedback_aggregator_config=FeedbackAggregatorConfig(min_feedback_threshold=3)
)
```

#### Technical Support Feedback

```python
support_feedback = AgentFeedbackConfig(
    feedback_name="technical_support_feedback",
    feedback_definition_prompt="""
    Extract feedback about technical support agent performance:
    - Accuracy of technical solutions provided
    - Speed and efficiency of problem resolution
    - Clarity of technical explanations for user level
    - Appropriate escalation and resource usage
    - Empathy and patience with frustrated users
    - Follow-through and issue closure quality
    """,
    feedback_aggregator_config=FeedbackAggregatorConfig(min_feedback_threshold=4)
)
```

### Multi-Agent Feedback Systems

For systems with multiple agent types:

```python
# Configure feedback for different agent roles
agent_feedback_configs = [
    AgentFeedbackConfig(
        feedback_name="sales_agent_feedback",
        feedback_definition_prompt="Extract sales-specific feedback..."
    ),
    AgentFeedbackConfig(
        feedback_name="support_agent_feedback",
        feedback_definition_prompt="Extract support-specific feedback..."
    ),
    AgentFeedbackConfig(
        feedback_name="onboarding_agent_feedback",
        feedback_definition_prompt="Extract onboarding-specific feedback..."
    )
]

# Apply all feedback configurations
config = client.get_config()
config.agent_feedback_configs = agent_feedback_configs
client.set_config(config)
```

## Using Feedback for Agent Improvement

### Feedback Analysis and Reporting

```python
def generate_feedback_report(agent_version=None):
    """Generate comprehensive feedback analysis for agent improvement."""

    # Get raw feedbacks
    raw_feedbacks = client.get_raw_feedbacks()

    # Filter by agent version if specified
    if agent_version:
        relevant_feedbacks = [
            fb for fb in raw_feedbacks.raw_feedbacks
            if fb.agent_version == agent_version
        ]
    else:
        relevant_feedbacks = raw_feedbacks.raw_feedbacks

    # Analyze feedback patterns
    feedback_categories = {}
    for feedback in relevant_feedbacks:
        category = feedback.feedback_name
        if category not in feedback_categories:
            feedback_categories[category] = []
        feedback_categories[category].append(feedback.feedback_content)

    # Generate report
    report = {
        "total_feedbacks": len(relevant_feedbacks),
        "agent_version": agent_version or "all_versions",
        "categories": {}
    }

    for category, feedbacks in feedback_categories.items():
        report["categories"][category] = {
            "count": len(feedbacks),
            "samples": feedbacks[:5],  # First 5 examples
            "common_themes": extract_common_themes(feedbacks)
        }

    return report

def extract_common_themes(feedbacks):
    """Extract common themes from feedback list (simplified)."""
    all_words = " ".join(feedbacks).lower().split()
    word_count = {}
    for word in all_words:
        if len(word) > 4:  # Filter short words
            word_count[word] = word_count.get(word, 0) + 1

    # Return most common meaningful words
    return sorted(word_count.items(), key=lambda x: x[1], reverse=True)[:10]
```

### Version Comparison and Regression Detection

```python
def compare_agent_versions(version_a, version_b):
    """Compare feedback between two agent versions."""

    raw_feedbacks = client.get_raw_feedbacks()

    version_a_feedback = [
        fb for fb in raw_feedbacks.raw_feedbacks
        if fb.agent_version == version_a
    ]

    version_b_feedback = [
        fb for fb in raw_feedbacks.raw_feedbacks
        if fb.agent_version == version_b
    ]

    comparison = {
        "version_a": {
            "version": version_a,
            "feedback_count": len(version_a_feedback),
            "sample_feedback": [fb.feedback_content for fb in version_a_feedback[:3]]
        },
        "version_b": {
            "version": version_b,
            "feedback_count": len(version_b_feedback),
            "sample_feedback": [fb.feedback_content for fb in version_b_feedback[:3]]
        }
    }

    # Identify potential regressions
    if len(version_b_feedback) > len(version_a_feedback) * 1.5:
        comparison["warning"] = "Significant increase in feedback volume - possible regression"

    return comparison
```

### Continuous Improvement Workflows

```python
class FeedbackDrivenImprovement:
    """System for continuous agent improvement based on feedback."""

    def __init__(self, client, agent_version):
        self.client = client
        self.agent_version = agent_version
        self.improvement_threshold = 5  # Feedbacks needed for action

    def identify_improvement_opportunities(self):
        """Identify specific areas needing improvement."""

        # Get raw feedback for current version
        raw_feedbacks = self.client.get_raw_feedbacks()
        version_feedback = [
            fb for fb in raw_feedbacks.raw_feedbacks
            if fb.agent_version == self.agent_version
        ]

        # Group feedback by theme
        improvement_areas = {}
        for feedback in version_feedback:
            # Categorize feedback (simplified)
            content_lower = feedback.feedback_content.lower()

            if "budget" in content_lower or "price" in content_lower:
                category = "budget_awareness"
            elif "communication" in content_lower or "tone" in content_lower:
                category = "communication_style"
            elif "accuracy" in content_lower or "correct" in content_lower:
                category = "response_accuracy"
            else:
                category = "general"

            if category not in improvement_areas:
                improvement_areas[category] = []
            improvement_areas[category].append(feedback.feedback_content)

        # Identify high-priority areas
        priority_areas = {
            category: feedbacks for category, feedbacks in improvement_areas.items()
            if len(feedbacks) >= self.improvement_threshold
        }

        return priority_areas

    def track_improvement_progress(self, previous_version):
        """Track whether improvements have been effective."""

        current_feedback = self.get_version_feedback(self.agent_version)
        previous_feedback = self.get_version_feedback(previous_version)

        # Simple progress tracking
        progress = {
            "current_version": self.agent_version,
            "previous_version": previous_version,
            "feedback_reduction": len(previous_feedback) - len(current_feedback),
            "improvement_detected": len(current_feedback) < len(previous_feedback)
        }

        return progress

    def get_version_feedback(self, version):
        """Get all feedback for a specific agent version."""
        raw_feedbacks = self.client.get_raw_feedbacks()
        return [
            fb for fb in raw_feedbacks.raw_feedbacks
            if fb.agent_version == version
        ]

# Usage
improvement_system = FeedbackDrivenImprovement(client, "v2.1.4")
opportunities = improvement_system.identify_improvement_opportunities()

print("Priority improvement areas:")
for area, feedbacks in opportunities.items():
    print(f"- {area}: {len(feedbacks)} pieces of feedback")
    print(f"  Sample: {feedbacks[0]}")
```

## Feedback-Driven Development Cycle

### 1. Deploy and Monitor

```python
# Deploy new agent version with feedback tracking
new_version = "v2.2.0"
publish_interactions_with_version(client, new_version)

# Monitor feedback collection
feedback_monitor = FeedbackMonitor(client, new_version)
feedback_monitor.start_monitoring()
```

### 2. Analyze and Prioritize

```python
# After sufficient interaction volume
feedback_analysis = generate_feedback_report(new_version)

# Prioritize improvements
high_priority = [
    category for category, data in feedback_analysis["categories"].items()
    if data["count"] >= 5  # Significant feedback volume
]
```

### 3. Implement and Validate

```python
# Implement improvements for next version
next_version = "v2.2.1"

# Deploy and compare
comparison = compare_agent_versions("v2.2.0", "v2.2.1")

if comparison.get("warning"):
    print("Potential regression detected - investigate immediately")
else:
    print("Feedback patterns stable or improved")
```

## Best Practices for Feedback Systems

### 1. Configure Meaningful Feedback Categories

```python
# Create specific, actionable feedback categories
feedback_categories = {
    "response_relevance": "How well agent responses match user intent",
    "communication_clarity": "Clarity and understandability of agent communication",
    "problem_resolution": "Effectiveness at solving user problems",
    "efficiency": "Speed and conciseness of agent interactions",
    "empathy": "Emotional intelligence and user sensitivity"
}
```

### 2. Set Appropriate Aggregation Thresholds

```python
# Balance signal vs. noise
aggregation_strategies = {
    "high_volume_system": FeedbackAggregatorConfig(min_feedback_threshold=10),
    "moderate_volume": FeedbackAggregatorConfig(min_feedback_threshold=5),
    "low_volume_system": FeedbackAggregatorConfig(min_feedback_threshold=2)
}
```

### 3. Regular Feedback Review Cycles

```python
def weekly_feedback_review():
    """Regular review process for feedback analysis."""

    # Get feedback from last week
    week_ago = int((datetime.now() - timedelta(days=7)).timestamp())
    recent_feedback = [
        fb for fb in client.get_raw_feedbacks().raw_feedbacks
        if fb.created_at >= week_ago
    ]

    if not recent_feedback:
        print("No feedback to review this week")
        return

    # Generate insights
    print(f"Weekly Feedback Review: {len(recent_feedback)} new pieces of feedback")

    # Group by category and analyze trends
    for feedback in recent_feedback[:5]:  # Show top 5
        print(f"- {feedback.feedback_content}")

    # Check for urgent issues (high-frequency negative feedback)
    urgent_issues = identify_urgent_feedback_issues(recent_feedback)
    if urgent_issues:
        print(f"ðŸš¨ Urgent issues detected: {urgent_issues}")
```

The feedback system transforms user responses into actionable insights that drive continuous agent improvement. By systematically collecting, analyzing, and acting on feedback, you create agents that become more effective and user-friendly over time.
